C51 COMPILER V9.00   I2C                                                                   03/20/2017 13:30:30 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\i2c.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE i2c\i2c.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\i
                    -2c.lst) TABS(2) OBJECT(.\Objects\i2c.obj)

line level    source

   1          /* i2c.c文件 */
   2          #include<reg51.h>
   3          #include<intrins.h>
   4          #include"i2c.h"
   5          
   6          #define nop() _nop_()
   7          
   8          void start_i2c()  //启动I2C总线:SCL高电平期间，SDA由高变低
   9          {
  10   1        SDA=1;         
  11   1        SCL=1;
  12   1        nop();nop();nop();nop();    
  13   1        SDA=0;       
  14   1        SCL=0;
  15   1      }
  16          
  17          void stop_i2c() //停止I2C总线，SCL高电平期间，SDA由低变高
  18          {
  19   1        SDA=0;          
  20   1        SCL=1;      
  21   1        nop();nop();nop();nop();
  22   1        SDA=1;
  23   1      }
  24          
  25          void slave_ack()  //等待从机应答信号，如果从机迟迟没有应答，则结束总线。  
  26          {
  27   1        unsigned char i;       
  28   1        SDA = 1;                        
  29   1        SCL = 1;
  30   1        i=200;       
  31   1        while(SDA&&(i--));                 
  32   1        if(!SDA)
  33   1          SCL = 0; 
  34   1        else
  35   1          stop_i2c();             
  36   1      }
  37          
  38          void send_i2c(unsigned char c)  //主机发送一个字节,先发送最高位
  39          {
  40   1        unsigned char  BitCnt;
  41   1        for(BitCnt=8;BitCnt>0;BitCnt--)  
  42   1        {
  43   2          c<<=1;
  44   2          SDA=CY;
  45   2          SCL=1;               
  46   2          nop();nop();nop();nop();        
  47   2          SCL=0; 
  48   2        }
  49   1      }
  50          
  51          unsigned char receive_i2c() //主机接收一个字节,先接收最高位
  52          {
  53   1        unsigned char  retc=0,BitCnt;   
  54   1        SDA=1;
C51 COMPILER V9.00   I2C                                                                   03/20/2017 13:30:30 PAGE 2   

  55   1        for(BitCnt=8;BitCnt>0;BitCnt--)
  56   1        {           
  57   2          retc<<=1;
  58   2          SCL=1;
  59   2          nop();nop();nop();nop();
  60   2          retc|=SDA;
  61   2          SCL=0;     
  62   2        }   
  63   1        return retc;
  64   1      }
  65          
  66          void master_ack(bit ack)  //主机非应答信号(填参数0)或应答信号(填参数1)
  67          {  
  68   1        SDA=!ack;     
  69   1        SCL=1;
  70   1        nop();nop();nop();nop();  
  71   1        SCL=0;    
  72   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    109    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
